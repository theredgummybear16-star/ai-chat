name: Private VPS Terminal

on:
  workflow_dispatch:
  push:
    branches: [ main ]

jobs:
  vps:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install System Tools
        run: |
          sudo apt update
          sudo apt install -y build-essential curl wget git vim htop tmux
          # Install ttyd (Web Terminal)
          sudo wget -q https://github.com/tsl0922/ttyd/releases/download/1.7.3/ttyd.x86_64 -O /usr/local/bin/ttyd
          sudo chmod +x /usr/local/bin/ttyd

      - name: Setup Ngrok
        run: |
          curl -s https://ngrok-agent.s3.amazonaws.com/ngrok.asc | sudo tee /etc/apt/trusted.gpg.d/ngrok.asc >/dev/null
          echo "deb https://ngrok-agent.s3.amazonaws.com buster main" | sudo tee /etc/apt/sources.list.d/ngrok.list
          sudo apt update && sudo apt install ngrok

      - name: Start Private Server
        run: |
          echo "=========================================================="
          echo "ðŸš€ YOUR PRIVATE VPS IS STARTING!"
          echo "URL: https://${{ secrets.NGROK_DOMAIN }}"
          echo "Username: admin"
          echo "Password: (The one you set in REMOTE_PASSWORD)"
          echo "=========================================================="
          
          # Start ttyd with basic auth in the background
          # Syntax: admin:password
          ttyd -p 7681 -c admin:${{ secrets.REMOTE_PASSWORD }} bash &
          
          # Wait for ttyd to be ready
          sleep 5
          
          # Expose via ngrok
          ngrok http 7681 --authtoken ${{ secrets.NGROK_AUTHTOKEN }} --domain ${{ secrets.NGROK_DOMAIN }}
